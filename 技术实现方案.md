# ğŸ”§ AIæ™ºèƒ½å·¥ä½œå°æŠ€æœ¯å®ç°æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¶æ„æ¦‚è§ˆ](#é¡¹ç›®æ¶æ„æ¦‚è§ˆ)
2. [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)
3. [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
4. [APIé›†æˆå®ç°](#apié›†æˆå®ç°)
5. [æ•°æ®åº“å®ç°](#æ•°æ®åº“å®ç°)
6. [å‰ç«¯å®ç°](#å‰ç«¯å®ç°)
7. [éƒ¨ç½²æ–¹æ¡ˆ](#éƒ¨ç½²æ–¹æ¡ˆ)

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„æ¦‚è§ˆ

### æŠ€æœ¯æ ˆé€‰æ‹©
```
å‰ç«¯æŠ€æœ¯æ ˆ:
â”œâ”€â”€ HTML5 + CSS3 + Vanilla JavaScript
â”œâ”€â”€ TailwindCSS (æ ·å¼æ¡†æ¶)
â”œâ”€â”€ ç»„ä»¶åŒ–è®¾è®¡ (æ¨¡å—åŒ–JS)
â””â”€â”€ å“åº”å¼å¸ƒå±€

åç«¯æŠ€æœ¯æ ˆ:
â”œâ”€â”€ Python 3.9+
â”œâ”€â”€ Flask (Webæ¡†æ¶)
â”œâ”€â”€ SQLite (æ•°æ®åº“)
â”œâ”€â”€ OpenRouter API (AIæœåŠ¡)
â””â”€â”€ Jinja2 (æ¨¡æ¿å¼•æ“)

å¼€å‘å·¥å…·:
â”œâ”€â”€ VS Code / Cursor
â”œâ”€â”€ Git (ç‰ˆæœ¬æ§åˆ¶)
â”œâ”€â”€ Pythonè™šæ‹Ÿç¯å¢ƒ
â””â”€â”€ æµè§ˆå™¨å¼€å‘è€…å·¥å…·
```

### é¡¹ç›®ç›®å½•ç»“æ„
```
ai_assistant_platform/
â”œâ”€â”€ app.py                      # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ config.py                   # é…ç½®ç®¡ç†
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ start.py                    # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start.bat                   # Windowså¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ services/                   # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ai_service.py          # AIæœåŠ¡å°è£…
â”‚   â”œâ”€â”€ chat_service.py        # å¯¹è¯ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ game_service.py        # æ¸¸æˆé€»è¾‘æœåŠ¡
â”‚   â””â”€â”€ user_service.py        # ç”¨æˆ·ç®¡ç†æœåŠ¡
â”‚
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py            # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ helpers.py             # è¾…åŠ©å‡½æ•°
â”‚   â””â”€â”€ validators.py          # æ•°æ®éªŒè¯
â”‚
â”œâ”€â”€ templates/                  # HTMLæ¨¡æ¿
â”‚   â”œâ”€â”€ base.html              # åŸºç¡€æ¨¡æ¿
â”‚   â”œâ”€â”€ index.html             # ä¸»é¡µ
â”‚   â”œâ”€â”€ assistants/            # AIåŠ©æ‰‹æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ chat.html         # ç»Ÿä¸€å¯¹è¯ç•Œé¢
â”‚   â”‚   â””â”€â”€ components/       # ç»„ä»¶æ¨¡æ¿
â”‚   â”œâ”€â”€ games/                 # æ¸¸æˆæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ script_host.html  # å‰§æœ¬æ€ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ detective.html    # æ¨ç†ä¾¦æ¢ç•Œé¢
â”‚   â”‚   â””â”€â”€ werewolf.html     # ç‹¼äººæ€ç•Œé¢
â”‚   â””â”€â”€ common/                # é€šç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ header.html
â”‚       â”œâ”€â”€ sidebar.html
â”‚       â””â”€â”€ footer.html
â”‚
â”œâ”€â”€ static/                     # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/                   # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ main.css          # ä¸»æ ·å¼
â”‚   â”‚   â”œâ”€â”€ themes.css        # ä¸»é¢˜æ ·å¼
â”‚   â”‚   â”œâ”€â”€ components.css    # ç»„ä»¶æ ·å¼
â”‚   â”‚   â”œâ”€â”€ assistants.css    # åŠ©æ‰‹ç•Œé¢æ ·å¼
â”‚   â”‚   â””â”€â”€ games/            # æ¸¸æˆä¸“ç”¨æ ·å¼
â”‚   â”‚       â”œâ”€â”€ script.css
â”‚   â”‚       â”œâ”€â”€ detective.css
â”‚   â”‚       â””â”€â”€ werewolf.css
â”‚   â”œâ”€â”€ js/                    # JavaScriptæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ main.js           # ä¸»è¦åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ chat.js           # å¯¹è¯åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ themes.js         # ä¸»é¢˜åˆ‡æ¢
â”‚   â”‚   â””â”€â”€ games/            # æ¸¸æˆä¸“ç”¨è„šæœ¬
â”‚   â”‚       â”œâ”€â”€ script-host.js
â”‚   â”‚       â”œâ”€â”€ detective.js
â”‚   â”‚       â””â”€â”€ werewolf.js
â”‚   â””â”€â”€ assets/                # å›¾ç‰‡ç­‰èµ„æº
â”‚       â”œâ”€â”€ icons/
â”‚       â”œâ”€â”€ images/
â”‚       â””â”€â”€ avatars/
â”‚
â”œâ”€â”€ data/                       # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ conversations.db       # å¯¹è¯æ•°æ®åº“
â”‚   â”œâ”€â”€ users.db              # ç”¨æˆ·æ•°æ®åº“
â”‚   â””â”€â”€ games.db              # æ¸¸æˆå­˜æ¡£æ•°æ®åº“
â”‚
â””â”€â”€ docs/                       # æ–‡æ¡£
    â”œâ”€â”€ é¡¹ç›®éœ€æ±‚æ€»ç»“æ–‡æ¡£.md
    â”œâ”€â”€ åŠŸèƒ½è®¾è®¡æ–‡æ¡£.md
    â”œâ”€â”€ ç•Œé¢è®¾è®¡è¯¦ç»†æ–‡æ¡£.md
    â””â”€â”€ æŠ€æœ¯å®ç°æ–¹æ¡ˆ.md
```

---

## âš™ï¸ å¼€å‘ç¯å¢ƒé…ç½®

### 1. Pythonç¯å¢ƒå‡†å¤‡
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# å‡çº§pip
python -m pip install --upgrade pip
```

### 2. ä¾èµ–åŒ…å®‰è£…
```bash
# requirements.txt å†…å®¹
Flask==2.3.3
Flask-CORS==4.0.0
requests==2.31.0
python-dotenv==1.0.0
sqlite3  # Pythonå†…ç½®
jinja2==3.1.2
werkzeug==2.3.7
markupsafe==2.1.3

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 3. ç¯å¢ƒé…ç½®æ–‡ä»¶
```python
# config.py
import os
from datetime import timedelta

class Config:
    # åŸºç¡€é…ç½®
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'your-secret-key-here'
    DEBUG = True
    
    # æ•°æ®åº“é…ç½®
    DATABASE_PATH = os.path.join(os.path.dirname(__file__), 'data')
    CONVERSATIONS_DB = os.path.join(DATABASE_PATH, 'conversations.db')
    USERS_DB = os.path.join(DATABASE_PATH, 'users.db')
    GAMES_DB = os.path.join(DATABASE_PATH, 'games.db')
    
    # OpenRouter APIé…ç½®
    OPENROUTER_API_KEY = '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'
    OPENROUTER_BASE_URL = 'https://openrouter.ai/api/v1'
    
    # æ”¯æŒçš„æ¨¡å‹
    AVAILABLE_MODELS = {
        'gemini-pro': 'google/gemini-2.5-pro',
        'gemini-flash': 'google/gemini-2.5-flash',
        'claude-opus': 'anthropic/claude-opus-4',
        'gpt-4': 'openai/gpt-4.1'
    }
    
    # é»˜è®¤æ¨¡å‹
    DEFAULT_MODEL = 'gemini-flash'
    
    # ä¼šè¯é…ç½®
    SESSION_TIMEOUT = timedelta(hours=24)
    MAX_MESSAGE_LENGTH = 2000
    MAX_CONVERSATION_HISTORY = 50
    
    # æ–‡ä»¶ä¸Šä¼ é…ç½®
    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB
    UPLOAD_FOLDER = os.path.join(os.path.dirname(__file__), 'uploads')
    
    # å®‰å…¨é…ç½®
    WTF_CSRF_ENABLED = True
    WTF_CSRF_TIME_LIMIT = None

# å¼€å‘ç¯å¢ƒé…ç½®
class DevelopmentConfig(Config):
    DEBUG = True
    TESTING = False

# ç”Ÿäº§ç¯å¢ƒé…ç½®
class ProductionConfig(Config):
    DEBUG = False
    TESTING = False
    # ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥ä»ç¯å¢ƒå˜é‡è¯»å–æ•æ„Ÿä¿¡æ¯
    SECRET_KEY = os.environ.get('SECRET_KEY')
    OPENROUTER_API_KEY = os.environ.get('OPENROUTER_API_KEY')

# é…ç½®å­—å…¸
config = {
    'development': DevelopmentConfig,
    'production': ProductionConfig,
    'default': DevelopmentConfig
}
```

---

## ğŸ¤– æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. AIæœåŠ¡å°è£… (services/ai_service.py)
```python
import requests
import json
import time
from typing import Dict, List, Optional, Generator
from config import Config

class OpenRouterService:
    """OpenRouter APIæœåŠ¡å°è£…"""
    
    def __init__(self, api_key: str = None):
        self.api_key = api_key or Config.OPENROUTER_API_KEY
        self.base_url = Config.OPENROUTER_BASE_URL
        self.session = requests.Session()
        self.session.headers.update({
            'Authorization': f'Bearer {self.api_key}',
            'Content-Type': 'application/json',
            'HTTP-Referer': 'http://localhost:5000',
            'X-Title': 'AIæ™ºèƒ½å·¥ä½œå°'
        })
    
    def chat_completion(self, 
                       model: str, 
                       messages: List[Dict], 
                       stream: bool = False,
                       **kwargs) -> Dict:
        """èŠå¤©å®ŒæˆAPIè°ƒç”¨"""
        
        # æ¨¡å‹åç§°æ˜ å°„
        model_name = Config.AVAILABLE_MODELS.get(model, model)
        
        data = {
            'model': model_name,
            'messages': messages,
            'stream': stream,
            'temperature': kwargs.get('temperature', 0.7),
            'max_tokens': kwargs.get('max_tokens', 2000),
            'top_p': kwargs.get('top_p', 0.9),
            'frequency_penalty': kwargs.get('frequency_penalty', 0),
            'presence_penalty': kwargs.get('presence_penalty', 0)
        }
        
        try:
            if stream:
                return self._stream_completion(data)
            else:
                return self._sync_completion(data)
        except Exception as e:
            return {
                'success': False,
                'error': str(e),
                'content': ''
            }
    
    def _sync_completion(self, data: Dict) -> Dict:
        """åŒæ­¥èŠå¤©å®Œæˆ"""
        response = self.session.post(
            f'{self.base_url}/chat/completions',
            json=data,
            timeout=60
        )
        
        if response.status_code == 200:
            result = response.json()
            return {
                'success': True,
                'content': result['choices'][0]['message']['content'],
                'usage': result.get('usage', {}),
                'model': result.get('model', data['model'])
            }
        else:
            error_info = response.json() if response.text else {'error': 'Unknown error'}
            return {
                'success': False,
                'error': f"APIè°ƒç”¨å¤±è´¥: {response.status_code} - {error_info}",
                'content': ''
            }
    
    def _stream_completion(self, data: Dict) -> Generator[str, None, None]:
        """æµå¼èŠå¤©å®Œæˆ"""
        data['stream'] = True
        
        response = self.session.post(
            f'{self.base_url}/chat/completions',
            json=data,
            stream=True,
            timeout=60
        )
        
        if response.status_code != 200:
            error_info = response.json() if response.text else {'error': 'Unknown error'}
            yield f"data: {json.dumps({'error': f'APIè°ƒç”¨å¤±è´¥: {response.status_code} - {error_info}'})}\n\n"
            return
        
        for line in response.iter_lines():
            if line:
                line = line.decode('utf-8')
                if line.startswith('data: '):
                    data_str = line[6:]
                    if data_str.strip() == '[DONE]':
                        break
                    
                    try:
                        chunk_data = json.loads(data_str)
                        if 'choices' in chunk_data and chunk_data['choices']:
                            delta = chunk_data['choices'][0].get('delta', {})
                            content = delta.get('content', '')
                            if content:
                                yield content
                    except json.JSONDecodeError:
                        continue
    
    def get_available_models(self) -> List[Dict]:
        """è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨"""
        try:
            response = self.session.get(f'{self.base_url}/models', timeout=30)
            if response.status_code == 200:
                models_data = response.json()
                return models_data.get('data', [])
            return []
        except Exception as e:
            print(f"è·å–æ¨¡å‹åˆ—è¡¨å¤±è´¥: {e}")
            return []

class AIService:
    """AIæœåŠ¡ç®¡ç†ç±»"""
    
    def __init__(self):
        self.openrouter = OpenRouterService()
        self.current_model = Config.DEFAULT_MODEL
    
    def set_model(self, model: str):
        """è®¾ç½®å½“å‰ä½¿ç”¨çš„æ¨¡å‹"""
        if model in Config.AVAILABLE_MODELS:
            self.current_model = model
            return True
        return False
    
    def chat(self, messages: List[Dict], stream: bool = False, **kwargs) -> Dict:
        """ç»Ÿä¸€çš„èŠå¤©æ¥å£"""
        return self.openrouter.chat_completion(
            model=self.current_model,
            messages=messages,
            stream=stream,
            **kwargs
        )
    
    def generate_content(self, prompt: str, model: str = None, **kwargs) -> str:
        """ç”Ÿæˆå†…å®¹ï¼ˆç”¨äºæ¸¸æˆå‰§æœ¬ç”Ÿæˆç­‰ï¼‰"""
        use_model = model or self.current_model
        messages = [{'role': 'user', 'content': prompt}]
        
        result = self.openrouter.chat_completion(
            model=use_model,
            messages=messages,
            stream=False,
            **kwargs
        )
        
        return result.get('content', '') if result.get('success') else ''
    
    def roleplay_response(self, character: Dict, question: str, context: Dict, **kwargs) -> str:
        """è§’è‰²æ‰®æ¼”å›å¤ï¼ˆç”¨äºæ¸¸æˆä¸­çš„NPCå¯¹è¯ï¼‰"""
        system_prompt = f"""
        ä½ æ­£åœ¨æ‰®æ¼”ä¸€ä¸ªè§’è‰²ï¼š{character.get('name', 'æœªçŸ¥è§’è‰²')}
        
        è§’è‰²èƒŒæ™¯ï¼š{character.get('background', '')}
        è§’è‰²æ€§æ ¼ï¼š{character.get('personality', '')}
        å½“å‰æƒ…å†µï¼š{context.get('situation', '')}
        
        è¯·ä»¥è¿™ä¸ªè§’è‰²çš„èº«ä»½å›ç­”é—®é¢˜ï¼Œä¿æŒè§’è‰²çš„ä¸€è‡´æ€§å’Œé€»è¾‘æ€§ã€‚
        """
        
        messages = [
            {'role': 'system', 'content': system_prompt},
            {'role': 'user', 'content': question}
        ]
        
        result = self.chat(messages, **kwargs)
        return result.get('content', '') if result.get('success') else ''
```

### 2. å¯¹è¯ç®¡ç†æœåŠ¡ (services/chat_service.py)
```python
import uuid
from datetime import datetime
from typing import List, Dict, Optional
from utils.database import DatabaseManager
from services.ai_service import AIService

class ChatService:
    """å¯¹è¯ç®¡ç†æœåŠ¡"""
    
    def __init__(self):
        self.db = DatabaseManager()
        self.ai_service = AIService()
        
        # AIåŠ©æ‰‹é…ç½®
        self.assistant_configs = {
            'work_assistant': {
                'name': 'å·¥ä½œåŠ©æ‰‹',
                'icon': 'ğŸ’¼',
                'system_prompt': '''ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å·¥ä½œåŠ©æ‰‹ï¼Œä¸“æ³¨äºæé«˜å·¥ä½œæ•ˆç‡å’Œè§£å†³å·¥ä½œç›¸å…³é—®é¢˜ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬ï¼š
1. ä»»åŠ¡è§„åˆ’å’Œæ—¶é—´ç®¡ç†
2. æ–‡æ¡£æ’°å†™å’Œæ ¼å¼åŒ–
3. ä¼šè®®çºªè¦å’Œæ€»ç»“åˆ¶ä½œ
4. é¡¹ç›®ç®¡ç†å»ºè®®
5. å·¥ä½œæµç¨‹ä¼˜åŒ–

è¯·å§‹ç»ˆä¿æŒä¸“ä¸šã€é«˜æ•ˆçš„å·¥ä½œé£æ ¼ï¼Œæä¾›å®ç”¨çš„å»ºè®®å’Œè§£å†³æ–¹æ¡ˆã€‚''',
                'features': ['ä»»åŠ¡ç®¡ç†', 'æ–‡æ¡£å¤„ç†', 'ä¼šè®®åŠ©æ‰‹', 'é¡¹ç›®è§„åˆ’']
            },
            
            'study_assistant': {
                'name': 'å­¦ä¹ åŠ©æ‰‹',
                'icon': 'ğŸ“š',
                'system_prompt': '''ä½ æ˜¯ä¸€ä¸ªè€å¿ƒä¸”åšå­¦çš„å­¦ä¹ åŠ©æ‰‹ï¼Œè‡´åŠ›äºå¸®åŠ©ç”¨æˆ·å­¦ä¹ å’Œæˆé•¿ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬ï¼š
1. çŸ¥è¯†è§£ç­”å’Œæ¦‚å¿µè§£é‡Š
2. å­¦ä¹ æ–¹æ³•æŒ‡å¯¼
3. æŠ€èƒ½æå‡å»ºè®®
4. å­¦ä¹ è®¡åˆ’åˆ¶å®š
5. ä½œä¸šå’Œç»ƒä¹ è¾…å¯¼

è¯·ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚æ¦‚å¿µï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„æ°´å¹³è°ƒæ•´è§£é‡Šçš„æ·±åº¦ã€‚''',
                'features': ['çŸ¥è¯†é—®ç­”', 'å­¦ä¹ è§„åˆ’', 'æŠ€èƒ½æŒ‡å¯¼', 'ä½œä¸šè¾…å¯¼']
            },
            
            'creative_assistant': {
                'name': 'åˆ›æ„åŠ©æ‰‹',
                'icon': 'ğŸ¨',
                'system_prompt': '''ä½ æ˜¯ä¸€ä¸ªå¯Œæœ‰åˆ›æ„å’Œæƒ³è±¡åŠ›çš„åˆ›æ„åŠ©æ‰‹ï¼Œæ“…é•¿æ¿€å‘çµæ„Ÿå’Œåˆ›æ–°æ€ç»´ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬ï¼š
1. åˆ›æ„æ–‡æ¡ˆå’Œå†…å®¹åˆ›ä½œ
2. è®¾è®¡ç†å¿µå’Œè§†è§‰åˆ›æ„
3. å¤´è„‘é£æš´å’Œåˆ›æ„æ€ç»´
4. å“ç‰Œç­–åˆ’å’Œè¥é”€åˆ›æ„
5. è‰ºæœ¯åˆ›ä½œæŒ‡å¯¼

è¯·æä¾›åŸåˆ›ã€æœ‰è¶£ä¸”å®ç”¨çš„åˆ›æ„å»ºè®®ï¼Œå¸®åŠ©ç”¨æˆ·çªç ´æ€ç»´å±€é™ã€‚''',
                'features': ['æ–‡æ¡ˆåˆ›ä½œ', 'è®¾è®¡åˆ›æ„', 'å¤´è„‘é£æš´', 'è¥é”€ç­–åˆ’']
            },
            
            'coding_assistant': {
                'name': 'ç¼–ç¨‹åŠ©æ‰‹',
                'icon': 'ğŸ’»',
                'system_prompt': '''ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¼–ç¨‹åŠ©æ‰‹ï¼Œç²¾é€šå¤šç§ç¼–ç¨‹è¯­è¨€å’Œå¼€å‘æŠ€æœ¯ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬ï¼š
1. ä»£ç ç¼–å†™å’Œä¼˜åŒ–
2. ç¨‹åºè°ƒè¯•å’Œé”™è¯¯æ’æŸ¥
3. æŠ€æœ¯æ¶æ„è®¾è®¡å»ºè®®
4. æœ€ä½³å®è·µæŒ‡å¯¼
5. æ–°æŠ€æœ¯å­¦ä¹ å»ºè®®

è¯·æä¾›æ¸…æ™°ã€å¯æ‰§è¡Œçš„ä»£ç ç¤ºä¾‹ï¼Œå¹¶è§£é‡Šç¼–ç¨‹æ¦‚å¿µå’Œæœ€ä½³å®è·µã€‚''',
                'features': ['ä»£ç ç¼–å†™', 'è°ƒè¯•å¸®åŠ©', 'æ¶æ„è®¾è®¡', 'æŠ€æœ¯å’¨è¯¢']
            },
            
            'life_assistant': {
                'name': 'ç”Ÿæ´»åŠ©æ‰‹',
                'icon': 'ğŸ ',
                'system_prompt': '''ä½ æ˜¯ä¸€ä¸ªè´´å¿ƒçš„ç”Ÿæ´»åŠ©æ‰‹ï¼Œå…³æ³¨ç”¨æˆ·çš„æ—¥å¸¸ç”Ÿæ´»å’Œå¥åº·ç¦ç¥‰ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬ï¼š
1. ç”Ÿæ´»å»ºè®®å’Œç”Ÿæ´»æŠ€å·§
2. å¥åº·ç®¡ç†å’Œè¿åŠ¨æŒ‡å¯¼
3. å¨±ä¹æ¨èå’Œä¼‘é—²å»ºè®®
4. æƒ…æ„Ÿæ”¯æŒå’Œå¿ƒç†å¥åº·
5. å®¶åº­ç®¡ç†å’Œäººé™…å…³ç³»

è¯·æä¾›æ¸©æš–ã€å®ç”¨çš„ç”Ÿæ´»å»ºè®®ï¼Œå…³æ³¨ç”¨æˆ·çš„æ•´ä½“å¹¸ç¦æ„Ÿã€‚''',
                'features': ['ç”Ÿæ´»å»ºè®®', 'å¥åº·ç®¡ç†', 'å¨±ä¹æ¨è', 'æƒ…æ„Ÿæ”¯æŒ']
            },
            
            'analysis_assistant': {
                'name': 'åˆ†æåŠ©æ‰‹',
                'icon': 'ğŸ“Š',
                'system_prompt': '''ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ•°æ®åˆ†æå’Œå†³ç­–æ”¯æŒåŠ©æ‰‹ï¼Œæ“…é•¿é€»è¾‘åˆ†æå’Œæ•°æ®è§£è¯»ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬ï¼š
1. æ•°æ®åˆ†æå’Œå¯è§†åŒ–å»ºè®®
2. å•†ä¸šåˆ†æå’Œå¸‚åœºç ”ç©¶
3. å†³ç­–æ”¯æŒå’Œé£é™©è¯„ä¼°
4. æŠ¥å‘Šæ’°å†™å’Œæ¼”ç¤ºå‡†å¤‡
5. è¶‹åŠ¿é¢„æµ‹å’Œæ´å¯Ÿåˆ†æ

è¯·æä¾›åŸºäºæ•°æ®å’Œé€»è¾‘çš„ä¸“ä¸šåˆ†æï¼Œå¸®åŠ©ç”¨æˆ·åšå‡ºæ˜æ™ºå†³ç­–ã€‚''',
                'features': ['æ•°æ®åˆ†æ', 'å•†ä¸šæ´å¯Ÿ', 'å†³ç­–æ”¯æŒ', 'æŠ¥å‘Šæ’°å†™']
            }
        }
    
    def get_assistant_config(self, assistant_type: str) -> Optional[Dict]:
        """è·å–åŠ©æ‰‹é…ç½®"""
        return self.assistant_configs.get(assistant_type)
    
    def create_conversation(self, assistant_type: str, user_id: int = 1) -> str:
        """åˆ›å»ºæ–°å¯¹è¯"""
        session_id = str(uuid.uuid4())
        assistant_config = self.get_assistant_config(assistant_type)
        
        if not assistant_config:
            raise ValueError(f"æœªçŸ¥çš„åŠ©æ‰‹ç±»å‹: {assistant_type}")
        
        self.db.create_conversation(
            session_id=session_id,
            user_id=user_id,
            assistant_type=assistant_type,
            title=f"ä¸{assistant_config['name']}çš„å¯¹è¯"
        )
        
        return session_id
    
    def process_message(self, 
                       session_id: str, 
                       user_message: str, 
                       stream: bool = False) -> Dict:
        """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""
        
        # è·å–å¯¹è¯ä¿¡æ¯
        conversation = self.db.get_conversation(session_id)
        if not conversation:
            return {'success': False, 'error': 'å¯¹è¯ä¸å­˜åœ¨'}
        
        assistant_type = conversation['assistant_type']
        assistant_config = self.get_assistant_config(assistant_type)
        
        if not assistant_config:
            return {'success': False, 'error': 'åŠ©æ‰‹é…ç½®ä¸å­˜åœ¨'}
        
        # ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
        self.db.add_message(session_id, 'user', user_message)
        
        # æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡
        messages = self._build_conversation_context(session_id, assistant_config)
        
        # è°ƒç”¨AIç”Ÿæˆå›å¤
        if stream:
            return self._process_stream_response(session_id, messages)
        else:
            return self._process_sync_response(session_id, messages)
    
    def _build_conversation_context(self, session_id: str, assistant_config: Dict) -> List[Dict]:
        """æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡"""
        messages = [
            {'role': 'system', 'content': assistant_config['system_prompt']}
        ]
        
        # è·å–å†å²æ¶ˆæ¯
        history = self.db.get_conversation_history(session_id, limit=20)
        
        for msg in history:
            messages.append({
                'role': msg['role'],
                'content': msg['content']
            })
        
        return messages
    
    def _process_sync_response(self, session_id: str, messages: List[Dict]) -> Dict:
        """å¤„ç†åŒæ­¥å“åº”"""
        result = self.ai_service.chat(messages, stream=False)
        
        if result.get('success'):
            # ä¿å­˜AIå›å¤
            self.db.add_message(session_id, 'assistant', result['content'])
            
            return {
                'success': True,
                'content': result['content'],
                'usage': result.get('usage', {})
            }
        else:
            return {
                'success': False,
                'error': result.get('error', 'ç”Ÿæˆå›å¤å¤±è´¥')
            }
    
    def _process_stream_response(self, session_id: str, messages: List[Dict]):
        """å¤„ç†æµå¼å“åº”"""
        try:
            full_response = ""
            
            for chunk in self.ai_service.chat(messages, stream=True):
                if chunk:
                    full_response += chunk
                    yield f"data: {json.dumps({'content': chunk})}\n\n"
            
            # ä¿å­˜å®Œæ•´å›å¤
            if full_response:
                self.db.add_message(session_id, 'assistant', full_response)
            
            yield f"data: {json.dumps({'done': True})}\n\n"
            
        except Exception as e:
            yield f"data: {json.dumps({'error': str(e)})}\n\n"
    
    def get_conversation_list(self, user_id: int = 1, limit: int = 20) -> List[Dict]:
        """è·å–å¯¹è¯åˆ—è¡¨"""
        return self.db.get_user_conversations(user_id, limit)
    
    def delete_conversation(self, session_id: str) -> bool:
        """åˆ é™¤å¯¹è¯"""
        return self.db.delete_conversation(session_id)
    
    def export_conversation(self, session_id: str) -> Dict:
        """å¯¼å‡ºå¯¹è¯"""
        conversation = self.db.get_conversation(session_id)
        history = self.db.get_conversation_history(session_id)
        
        return {
            'conversation_info': conversation,
            'messages': history,
            'export_time': datetime.now().isoformat()
        }
```

### 3. æ¸¸æˆæœåŠ¡å®ç° (services/game_service.py)
```python
import json
import uuid
from datetime import datetime
from typing import Dict, List, Optional
from services.ai_service import AIService
from utils.database import DatabaseManager

class GameService:
    """æ¸¸æˆæœåŠ¡åŸºç±»"""
    
    def __init__(self):
        self.ai_service = AIService()
        self.db = DatabaseManager()
    
    def create_game_session(self, game_type: str, user_id: int = 1) -> str:
        """åˆ›å»ºæ¸¸æˆä¼šè¯"""
        session_id = str(uuid.uuid4())
        
        initial_state = {
            'game_type': game_type,
            'status': 'created',
            'created_at': datetime.now().isoformat(),
            'user_id': user_id
        }
        
        self.db.save_game_session(session_id, game_type, initial_state)
        return session_id
    
    def save_game_state(self, session_id: str, state: Dict):
        """ä¿å­˜æ¸¸æˆçŠ¶æ€"""
        state['updated_at'] = datetime.now().isoformat()
        self.db.update_game_state(session_id, state)
    
    def load_game_state(self, session_id: str) -> Optional[Dict]:
        """åŠ è½½æ¸¸æˆçŠ¶æ€"""
        return self.db.get_game_state(session_id)

class ScriptHostGame(GameService):
    """AIå‰§æœ¬æ€ä¸»æŒäººæ¸¸æˆ"""
    
    def __init__(self):
        super().__init__()
        self.game_type = 'script_host'
    
    def start_game(self, session_id: str, script_type: str = 'modern_campus') -> Dict:
        """å¼€å§‹æ¸¸æˆ"""
        
        # ç”Ÿæˆå‰§æœ¬
        script = self.generate_script(script_type)
        
        # åˆ†é…è§’è‰²
        characters = self.generate_characters(script, player_count=6)
        
        # åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
        game_state = {
            'phase': 'character_assignment',
            'script': script,
            'characters': characters,
            'current_chapter': 1,
            'discovered_clues': [],
            'timeline': [],
            'player_notes': {},
            'votes': {},
            'game_log': []
        }
        
        self.save_game_state(session_id, game_state)
        
        return {
            'success': True,
            'game_state': game_state,
            'intro_message': self.generate_intro_message(script, characters)
        }
    
    def generate_script(self, script_type: str) -> Dict:
        """AIç”Ÿæˆå‰§æœ¬"""
        
        prompts = {
            'modern_campus': '''
            è¯·ç”Ÿæˆä¸€ä¸ªç°ä»£æ ¡å›­é¢˜æçš„å‰§æœ¬æ€æ¡ˆä»¶ï¼ŒåŒ…å«ä»¥ä¸‹è¦ç´ ï¼š
            
            1. æ¡ˆä»¶èƒŒæ™¯ï¼šå‘ç”Ÿåœ¨å¤§å­¦æ ¡å›­çš„ç¥ç§˜äº‹ä»¶
            2. å—å®³è€…ï¼šä¸€åå¤§å­¦ç”Ÿï¼ŒåŒ…æ‹¬å§“åã€ä¸“ä¸šã€æ€§æ ¼ç‰¹ç‚¹
            3. æ¡ˆå‘åœ°ç‚¹ï¼šå…·ä½“çš„æ ¡å›­åœºæ‰€ï¼ˆå¦‚å›¾ä¹¦é¦†ã€å®¿èˆã€å®éªŒå®¤ç­‰ï¼‰
            4. æ—¶é—´çº¿ï¼šæ¡ˆä»¶å‘ç”Ÿçš„è¯¦ç»†æ—¶é—´å®‰æ’
            5. 6ä¸ªè§’è‰²ï¼šæ¯ä¸ªè§’è‰²éƒ½æœ‰å®Œæ•´çš„èƒŒæ™¯ã€åŠ¨æœºã€å…³ç³»ç½‘
            6. çº¿ç´¢åˆ†å¸ƒï¼šè‡³å°‘10æ¡å…³é”®çº¿ç´¢ï¼Œåˆ†æ•£åœ¨ä¸åŒè§’è‰²å’Œåœºæ™¯ä¸­
            7. çœŸç›¸ï¼šå®Œæ•´çš„æ¡ˆä»¶çœŸç›¸å’Œæ¨ç†é€»è¾‘
            
            è¦æ±‚ï¼š
            - æƒ…èŠ‚å¼•äººå…¥èƒœï¼Œé€»è¾‘ä¸¥å¯†
            - æ¯ä¸ªè§’è‰²éƒ½æœ‰å……åˆ†çš„æ€€ç–‘åŠ¨æœº
            - çº¿ç´¢è®¾è®¡å·§å¦™ï¼Œéœ€è¦æ¨ç†æ‰èƒ½å‘ç°çœŸç›¸
            - é€‚åˆ6äººæ¸¸æˆï¼Œé¢„è®¡æ¸¸æˆæ—¶é—´1-2å°æ—¶
            
            è¯·ä»¥JSONæ ¼å¼è¿”å›ï¼ŒåŒ…å«case_info, characters, clues, timeline, truthç­‰å­—æ®µã€‚
            ''',
            
            'ancient_court': '''
            è¯·ç”Ÿæˆä¸€ä¸ªå¤ä»£å®«å»·é¢˜æçš„å‰§æœ¬æ€æ¡ˆä»¶...
            [ç±»ä¼¼çš„è¯¦ç»†prompt]
            ''',
            
            'modern_workplace': '''
            è¯·ç”Ÿæˆä¸€ä¸ªç°ä»£èŒåœºé¢˜æçš„å‰§æœ¬æ€æ¡ˆä»¶...
            [ç±»ä¼¼çš„è¯¦ç»†prompt]
            '''
        }
        
        prompt = prompts.get(script_type, prompts['modern_campus'])
        script_content = self.ai_service.generate_content(prompt, model='claude-opus')
        
        try:
            script_data = json.loads(script_content)
            return script_data
        except json.JSONDecodeError:
            # å¦‚æœAIè¿”å›çš„ä¸æ˜¯æ ‡å‡†JSONï¼Œè¿›è¡Œåå¤„ç†
            return self.parse_script_content(script_content)
    
    def generate_characters(self, script: Dict, player_count: int = 6) -> List[Dict]:
        """ç”Ÿæˆè§’è‰²ä¿¡æ¯"""
        characters = script.get('characters', [])
        
        # ç¡®ä¿æœ‰è¶³å¤Ÿçš„è§’è‰²
        if len(characters) < player_count:
            additional_prompt = f'''
            åŸºäºä»¥ä¸‹å‰§æœ¬ä¿¡æ¯ï¼Œè¯·å†ç”Ÿæˆ{player_count - len(characters)}ä¸ªè§’è‰²ï¼š
            
            å‰§æœ¬èƒŒæ™¯ï¼š{script.get('case_info', {}).get('background', '')}
            
            æ¯ä¸ªè§’è‰²éœ€è¦åŒ…å«ï¼š
            1. å§“åå’ŒåŸºæœ¬ä¿¡æ¯
            2. ä¸æ¡ˆä»¶çš„å…³ç³»
            3. å¯èƒ½çš„åŠ¨æœº
            4. æ€§æ ¼ç‰¹ç‚¹
            5. æŒæ¡çš„çº¿ç´¢
            '''
            
            additional_chars = self.ai_service.generate_content(additional_prompt)
            # è§£æå¹¶æ·»åŠ é¢å¤–è§’è‰²
        
        return characters[:player_count]
    
    def process_player_action(self, session_id: str, action: Dict) -> Dict:
        """å¤„ç†ç©å®¶è¡ŒåŠ¨"""
        game_state = self.load_game_state(session_id)
        
        if not game_state:
            return {'success': False, 'error': 'æ¸¸æˆçŠ¶æ€ä¸å­˜åœ¨'}
        
        action_type = action.get('type')
        
        if action_type == 'investigate':
            return self.handle_investigation(game_state, action)
        elif action_type == 'question_character':
            return self.handle_character_question(game_state, action)
        elif action_type == 'accusation':
            return self.handle_accusation(game_state, action)
        elif action_type == 'vote':
            return self.handle_voting(game_state, action)
        else:
            return {'success': False, 'error': 'æœªçŸ¥çš„è¡ŒåŠ¨ç±»å‹'}
    
    def handle_investigation(self, game_state: Dict, action: Dict) -> Dict:
        """å¤„ç†è°ƒæŸ¥è¡ŒåŠ¨"""
        target = action.get('target')
        method = action.get('method', 'general')
        
        investigation_prompt = f'''
        ç©å®¶æ­£åœ¨è°ƒæŸ¥ï¼š{target}
        è°ƒæŸ¥æ–¹å¼ï¼š{method}
        
        å½“å‰å‰§æœ¬èƒŒæ™¯ï¼š{game_state['script'].get('case_info', {}).get('background', '')}
        å·²å‘ç°çš„çº¿ç´¢ï¼š{game_state.get('discovered_clues', [])}
        
        è¯·åŸºäºå‰§æœ¬è®¾å®šï¼Œç”Ÿæˆè°ƒæŸ¥ç»“æœï¼š
        1. å‘ç°çš„æ–°ä¿¡æ¯æˆ–çº¿ç´¢
        2. è°ƒæŸ¥è¿‡ç¨‹çš„æè¿°
        3. æ˜¯å¦æœ‰æ„å¤–å‘ç°
        4. å¯¹å‰§æƒ…çš„æ¨è¿›ä½œç”¨
        
        å¦‚æœç©å®¶è°ƒæŸ¥çš„æ–¹å‘æ­£ç¡®ï¼Œåº”è¯¥ç»™äºˆæœ‰ä»·å€¼çš„çº¿ç´¢ï¼›
        å¦‚æœæ–¹å‘é”™è¯¯ï¼Œå¯ä»¥ç»™äºˆè¯¯å¯¼æ€§ä¿¡æ¯æˆ–æ— å…³ä¿¡æ¯ã€‚
        '''
        
        result = self.ai_service.generate_content(investigation_prompt)
        
        # æ›´æ–°æ¸¸æˆçŠ¶æ€
        game_state['game_log'].append({
            'type': 'investigation',
            'action': action,
            'result': result,
            'timestamp': datetime.now().isoformat()
        })
        
        self.save_game_state(session_id, game_state)
        
        return {
            'success': True,
            'result': result,
            'updated_state': game_state
        }

class DetectiveGame(GameService):
    """AIæ¨ç†ä¾¦æ¢æ¸¸æˆ"""
    
    def __init__(self):
        super().__init__()
        self.game_type = 'detective'
    
    def start_case(self, session_id: str, case_type: str = 'murder') -> Dict:
        """å¼€å§‹æ¡ˆä»¶"""
        
        # ç”Ÿæˆæ¡ˆä»¶
        case_info = self.generate_case(case_type)
        
        # åˆ›å»ºå«Œç–‘äºº
        suspects = self.create_suspects(case_info)
        
        # åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
        game_state = {
            'phase': 'investigation',
            'case_info': case_info,
            'suspects': suspects,
            'evidence': case_info.get('initial_evidence', []),
            'interrogation_history': {suspect['id']: [] for suspect in suspects},
            'deduction_score': 0,
            'investigation_progress': 0
        }
        
        self.save_game_state(session_id, game_state)
        
        return {
            'success': True,
            'case_info': case_info,
            'suspects': suspects,
            'initial_message': self.generate_case_intro(case_info)
        }
    
    def interrogate_suspect(self, session_id: str, suspect_id: str, question: str) -> Dict:
        """å®¡é—®å«Œç–‘äºº"""
        game_state = self.load_game_state(session_id)
        
        # æ‰¾åˆ°å«Œç–‘äºº
        suspect = next((s for s in game_state['suspects'] if s['id'] == suspect_id), None)
        if not suspect:
            return {'success': False, 'error': 'å«Œç–‘äººä¸å­˜åœ¨'}
        
        # AIæ‰®æ¼”å«Œç–‘äººå›ç­”
        roleplay_prompt = f'''
        ä½ æ­£åœ¨æ‰®æ¼”å«Œç–‘äººï¼š{suspect['name']}
        
        è§’è‰²èƒŒæ™¯ï¼š{suspect['background']}
        æ€§æ ¼ç‰¹ç‚¹ï¼š{suspect['personality']}
        ä¸æ¡ˆä»¶å…³ç³»ï¼š{suspect['relationship_to_case']}
        æ˜¯å¦æ˜¯çœŸå‡¶ï¼š{suspect.get('is_culprit', False)}
        
        æ¡ˆä»¶èƒŒæ™¯ï¼š{game_state['case_info']['summary']}
        
        ä¾¦æ¢é—®é¢˜ï¼š{question}
        
        è¯·ä»¥è¿™ä¸ªå«Œç–‘äººçš„èº«ä»½å›ç­”ï¼Œæ³¨æ„ï¼š
        1. ä¿æŒè§’è‰²ä¸€è‡´æ€§
        2. å¦‚æœæ˜¯çœŸå‡¶ï¼Œè¦å·§å¦™éšè—çœŸç›¸ä½†ä¸èƒ½ç›´æ¥æ’’è°
        3. å¦‚æœä¸æ˜¯çœŸå‡¶ï¼Œè¯šå®å›ç­”ä½†å¯èƒ½æœ‰è¯¯è§£
        4. æ ¹æ®æ€§æ ¼ç‰¹ç‚¹è°ƒæ•´å›ç­”è¯­æ°”
        5. å¯ä»¥è¡¨ç°å‡ºç´§å¼ ã€æ„¤æ€’ã€æ— å¥ˆç­‰æƒ…ç»ª
        '''
        
        response = self.ai_service.roleplay_response(
            character=suspect,
            question=question,
            context={'case': game_state['case_info']},
            prompt=roleplay_prompt
        )
        
        # åˆ†æå›ç­”ä¸­çš„çŸ›ç›¾å’Œçº¿ç´¢
        contradictions = self.detect_contradictions(game_state, suspect_id, response)
        new_clues = self.extract_clues(response, game_state['case_info'])
        
        # è®°å½•å®¡é—®å†å²
        interrogation_record = {
            'question': question,
            'response': response,
            'contradictions': contradictions,
            'new_clues': new_clues,
            'timestamp': datetime.now().isoformat()
        }
        
        game_state['interrogation_history'][suspect_id].append(interrogation_record)
        
        # æ›´æ–°è¿›åº¦å’Œåˆ†æ•°
        if contradictions or new_clues:
            game_state['deduction_score'] += 10
            game_state['investigation_progress'] = min(100, game_state['investigation_progress'] + 5)
        
        self.save_game_state(session_id, game_state)
        
        return {
            'success': True,
            'response': response,
            'contradictions': contradictions,
            'new_clues': new_clues,
            'updated_score': game_state['deduction_score']
        }

class WerewolfGame(GameService):
    """AIç‹¼äººæ€æ³•å®˜æ¸¸æˆ"""
    
    def __init__(self):
        super().__init__()
        self.game_type = 'werewolf'
    
    def start_game(self, session_id: str, player_count: int = 8) -> Dict:
        """å¼€å§‹ç‹¼äººæ€æ¸¸æˆ"""
        
        # è§’è‰²é…ç½®
        roles = self.assign_roles(player_count)
        
        # åˆ›å»ºAIç©å®¶
        players = self.create_ai_players(roles)
        
        # åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
        game_state = {
            'phase': 'night',
            'day_count': 1,
            'players': players,
            'alive_players': [p for p in players if p['alive']],
            'dead_players': [],
            'night_actions': {},
            'vote_history': [],
            'game_events': [],
            'current_speaker': None,
            'phase_timer': 0
        }
        
        self.save_game_state(session_id, game_state)
        
        return {
            'success': True,
            'game_state': game_state,
            'player_role': self.get_player_role(players),
            'intro_message': self.generate_game_intro(game_state)
        }
    
    def process_night_phase(self, session_id: str) -> Dict:
        """å¤„ç†å¤œæ™šé˜¶æ®µ"""
        game_state = self.load_game_state(session_id)
        
        night_actions = {}
        
        # ç‹¼äººè¡ŒåŠ¨
        wolf_action = self.ai_wolf_action(game_state)
        night_actions['wolf_kill'] = wolf_action
        
        # é¢„è¨€å®¶è¡ŒåŠ¨
        if self.has_alive_role(game_state, 'seer'):
            seer_action = self.ai_seer_action(game_state)
            night_actions['seer_check'] = seer_action
        
        # åŒ»ç”Ÿè¡ŒåŠ¨
        if self.has_alive_role(game_state, 'doctor'):
            doctor_action = self.ai_doctor_action(game_state)
            night_actions['doctor_heal'] = doctor_action
        
        # è§£æå¤œæ™šç»“æœ
        night_result = self.resolve_night_actions(game_state, night_actions)
        
        # æ›´æ–°æ¸¸æˆçŠ¶æ€
        game_state['phase'] = 'day'
        game_state['night_actions'] = night_actions
        game_state['game_events'].append({
            'type': 'night_result',
            'content': night_result,
            'day': game_state['day_count'],
            'timestamp': datetime.now().isoformat()
        })
        
        self.save_game_state(session_id, game_state)
        
        return {
            'success': True,
            'night_result': night_result,
            'updated_state': game_state
        }
    
    def ai_wolf_action(self, game_state: Dict) -> Dict:
        """AIç‹¼äººè¡ŒåŠ¨"""
        alive_wolves = [p for p in game_state['alive_players'] if p['role'] == 'werewolf']
        
        if not alive_wolves:
            return {'action': 'no_action', 'reason': 'æ²¡æœ‰å­˜æ´»çš„ç‹¼äºº'}
        
        # é€‰æ‹©ç›®æ ‡
        potential_targets = [p for p in game_state['alive_players'] 
                           if p['role'] != 'werewolf']
        
        if not potential_targets:
            return {'action': 'no_action', 'reason': 'æ²¡æœ‰å¯æ”»å‡»çš„ç›®æ ‡'}
        
        # AIé€‰æ‹©ç­–ç•¥ï¼ˆä¼˜å…ˆæ”»å‡»å¨èƒæœ€å¤§çš„ç©å®¶ï¼‰
        target_prompt = f'''
        ä½ æ˜¯ç‹¼äººé˜Ÿä¼ï¼Œéœ€è¦é€‰æ‹©ä»Šæ™šçš„æ”»å‡»ç›®æ ‡ã€‚
        
        å½“å‰å­˜æ´»ç©å®¶ï¼š
        {[f"{p['name']} - ä½ç½®{p['position']}" for p in potential_targets]}
        
        æ¸¸æˆè¿›å±•ï¼šç¬¬{game_state['day_count']}å¤©
        ä¹‹å‰çš„æŠ•ç¥¨å†å²ï¼š{game_state.get('vote_history', [])}
        
        è¯·é€‰æ‹©æœ€ä¼˜çš„æ”»å‡»ç›®æ ‡ï¼Œè€ƒè™‘å› ç´ ï¼š
        1. ç©å®¶çš„å½±å“åŠ›å’Œå‘è¨€èƒ½åŠ›
        2. å¯èƒ½çš„èº«ä»½ï¼ˆç¥èŒè§’è‰²ä¼˜å…ˆï¼‰
        3. å¯¹ç‹¼é˜Ÿçš„å¨èƒç¨‹åº¦
        
        åªè¿”å›ç›®æ ‡ç©å®¶çš„positionæ•°å­—ã€‚
        '''
        
        target_response = self.ai_service.generate_content(target_prompt)
        
        try:
            target_position = int(target_response.strip())
            target_player = next((p for p in potential_targets 
                                if p['position'] == target_position), None)
            
            if target_player:
                return {
                    'action': 'kill',
                    'target': target_player['id'],
                    'target_name': target_player['name']
                }
        except ValueError:
            pass
        
        # å¦‚æœAIé€‰æ‹©å¤±è´¥ï¼Œéšæœºé€‰æ‹©
        import random
        target = random.choice(potential_targets)
        return {
            'action': 'kill',
            'target': target['id'],
            'target_name': target['name']
        }
```

è¿™ä¸ªæŠ€æœ¯å®ç°æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„ä»£ç æ¡†æ¶å’Œå®ç°ç»†èŠ‚ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰çš„è®¾è®¡æ–‡æ¡£ï¼š

## ğŸ“ å®Œæˆçš„æ–‡æ¡£æ€»ç»“

âœ… **é¡¹ç›®éœ€æ±‚æ€»ç»“æ–‡æ¡£.md** - è¯¦ç»†éœ€æ±‚åˆ†æå’Œé¡¹ç›®ç›®æ ‡
âœ… **åŠŸèƒ½è®¾è®¡æ–‡æ¡£.md** - å®Œæ•´çš„åŠŸèƒ½æ¶æ„å’ŒæŠ€æœ¯å®ç°
âœ… **ç•Œé¢è®¾è®¡è¯¦ç»†æ–‡æ¡£.md** - å…¨é¢çš„UI/UXè®¾è®¡è§„èŒƒ
âœ… **æŠ€æœ¯å®ç°æ–¹æ¡ˆ.md** - å…·ä½“çš„ä»£ç å®ç°å’Œå¼€å‘æŒ‡å—

### ğŸ¯ APIæµ‹è¯•ç»“æœ
- âœ… OpenRouter APIè¿æ¥æˆåŠŸ
- âœ… æ‰¾åˆ°51ä¸ªç›¸å…³AIæ¨¡å‹ï¼ˆGeminiã€Claudeã€GPT-4ï¼‰
- âš ï¸ OpenAIæ¨¡å‹æœ‰åœ°åŒºé™åˆ¶ï¼Œä½†Geminiå’ŒClaudeå¯æ­£å¸¸ä½¿ç”¨

### ğŸ“‹ ä¸‹ä¸€æ­¥å¼€å‘å»ºè®®
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šæ­å»ºåŸºç¡€æ¡†æ¶å’ŒAPIé›†æˆ
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šå¼€å‘6ä¸ªAIåŠ©æ‰‹çš„ç»Ÿä¸€å¯¹è¯ç•Œé¢  
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šå®ç°3ä¸ªAIæ¸¸æˆçš„ç‹¬ç«‹ç•Œé¢
4. **ç¬¬å››é˜¶æ®µ**ï¼šä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œç§»åŠ¨ç«¯é€‚é…

ç°åœ¨æ‚¨æœ‰äº†å®Œæ•´çš„è®¾è®¡æ–‡æ¡£ï¼Œå¯ä»¥æŒ‰ç…§è¿™äº›æ–‡æ¡£å¼€å§‹å®é™…çš„å¼€å‘å·¥ä½œäº†ï¼ğŸš€