# AI助手平台 Supervisor 配置文件
# 放置于: /etc/supervisor/conf.d/aiplatform.conf

[program:aiplatform]
# 命令配置
command=/home/aiplatform/ai_assistant_platform/venv/bin/gunicorn start:app -c /home/aiplatform/ai_assistant_platform/deploy/gunicorn.conf.py
directory=/home/aiplatform/ai_assistant_platform
user=aiplatform
group=aiplatform

# 环境变量
environment=FLASK_ENV="production",PATH="/home/aiplatform/ai_assistant_platform/venv/bin"

# 自动启动和重启
autostart=true
autorestart=true
startsecs=5
startretries=3
stopwaitsecs=10

# 日志配置
stdout_logfile=/home/aiplatform/ai_assistant_platform/logs/supervisor_stdout.log
stderr_logfile=/home/aiplatform/ai_assistant_platform/logs/supervisor_stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile_backups=5
stdout_capture_maxbytes=1MB
stderr_capture_maxbytes=1MB

# 进程优先级
priority=999

# 重定向stderr到stdout
redirect_stderr=false

# 停止信号
stopsignal=TERM

# 子进程管理
killasgroup=true
stopasgroup=true

[group:aiplatform_group]
programs=aiplatform
priority=999