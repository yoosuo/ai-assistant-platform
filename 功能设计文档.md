# ğŸ› ï¸ AIæ™ºèƒ½å·¥ä½œå°åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#ç³»ç»Ÿæ¶æ„è®¾è®¡)
2. [AIåŠ©æ‰‹åŠŸèƒ½è®¾è®¡](#aiåŠ©æ‰‹åŠŸèƒ½è®¾è®¡)
3. [AIæ¸¸æˆåŠŸèƒ½è®¾è®¡](#aiæ¸¸æˆåŠŸèƒ½è®¾è®¡)
4. [APIé›†æˆæ–¹æ¡ˆ](#apié›†æˆæ–¹æ¡ˆ)
5. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
6. [ç”¨æˆ·äº¤äº’æµç¨‹](#ç”¨æˆ·äº¤äº’æµç¨‹)

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ç•Œé¢å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   AIåŠ©æ‰‹ç•Œé¢    â”‚    æ¸¸æˆç•Œé¢     â”‚      ç®¡ç†ç•Œé¢       â”‚
â”‚   (ç»Ÿä¸€é£æ ¼)    â”‚   (ç‹¬ç«‹è®¾è®¡)    â”‚    (é…ç½®&ç”¨æˆ·)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Flaskè·¯ç”±å±‚                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              ä¸šåŠ¡é€»è¾‘å±‚ (Services)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  AIæœåŠ¡     â”‚   æ¸¸æˆæœåŠ¡   â”‚     ç”¨æˆ·æœåŠ¡       â”‚   â”‚
â”‚  â”‚ (å¯¹è¯ç®¡ç†)  â”‚ (è§’è‰²&å‰§æƒ…)  â”‚   (è®¤è¯&è®°å½•)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 OpenRouter APIå±‚                        â”‚
â”‚         (Gemini, Claude, GPT-4ç»Ÿä¸€æ¥å£)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  æ•°æ®æŒä¹…å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   ç”¨æˆ·æ•°æ®  â”‚   å¯¹è¯å†å²   â”‚    æ¸¸æˆå­˜æ¡£        â”‚   â”‚
â”‚  â”‚  (SQLite)   â”‚  (SQLite)   â”‚    (SQLite)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—åˆ’åˆ†
```python
ai_assistant_platform/
â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”œâ”€â”€ ai_service.py        # AIæœåŠ¡ï¼ˆOpenRouteré›†æˆï¼‰
â”‚   â”œâ”€â”€ chat_service.py      # å¯¹è¯ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ game_service.py      # æ¸¸æˆé€»è¾‘æœåŠ¡
â”‚   â””â”€â”€ user_service.py      # ç”¨æˆ·ç®¡ç†æœåŠ¡
â”œâ”€â”€ templates/               # å‰ç«¯æ¨¡æ¿
â”‚   â”œâ”€â”€ assistants/          # AIåŠ©æ‰‹ç•Œé¢
â”‚   â”œâ”€â”€ games/               # æ¸¸æˆç•Œé¢
â”‚   â””â”€â”€ common/              # é€šç”¨ç»„ä»¶
â”œâ”€â”€ static/                  # é™æ€èµ„æº
â”‚   â”œâ”€â”€ css/                 # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ js/                  # JavaScriptæ–‡ä»¶
â”‚   â””â”€â”€ assets/              # å›¾ç‰‡ç­‰èµ„æº
â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
    â”œâ”€â”€ database.py          # æ•°æ®åº“æ“ä½œ
    â””â”€â”€ helpers.py           # è¾…åŠ©å‡½æ•°
```

---

## ğŸ¤– AIåŠ©æ‰‹åŠŸèƒ½è®¾è®¡

### 1. ç»Ÿä¸€å¯¹è¯ç³»ç»Ÿ

#### æ ¸å¿ƒç»„ä»¶
```python
class ChatService:
    def __init__(self):
        self.ai_service = AIService()
        self.memory_service = MemoryService()
    
    def process_message(self, assistant_type, message, session_id):
        """å¤„ç†ç”¨æˆ·æ¶ˆæ¯å¹¶ç”Ÿæˆå›å¤"""
        # è·å–åŠ©æ‰‹é…ç½®
        assistant_config = self.get_assistant_config(assistant_type)
        
        # æ„å»ºå¯¹è¯ä¸Šä¸‹æ–‡
        context = self.build_context(session_id, assistant_config)
        
        # è°ƒç”¨AIç”Ÿæˆå›å¤
        response = self.ai_service.chat_completion(context, message)
        
        # ä¿å­˜å¯¹è¯è®°å½•
        self.save_conversation(session_id, message, response)
        
        return response
```

#### åŠ©æ‰‹ç±»å‹é…ç½®
```python
ASSISTANT_CONFIGS = {
    "work_assistant": {
        "name": "å·¥ä½œåŠ©æ‰‹",
        "icon": "ğŸ’¼",
        "system_prompt": """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å·¥ä½œåŠ©æ‰‹ï¼Œå…·å¤‡ä»¥ä¸‹èƒ½åŠ›ï¼š
        - ä»»åŠ¡è§„åˆ’å’Œæ—¶é—´ç®¡ç†
        - æ–‡æ¡£æ’°å†™å’Œæ ¼å¼åŒ–
        - ä¼šè®®çºªè¦å’Œæ€»ç»“
        - é¡¹ç›®ç®¡ç†å»ºè®®
        
        è¯·ä»¥ä¸“ä¸šã€é«˜æ•ˆçš„æ–¹å¼ååŠ©ç”¨æˆ·å®Œæˆå·¥ä½œä»»åŠ¡ã€‚""",
        "theme_color": "#2E6CFB",
        "features": ["ä»»åŠ¡ç®¡ç†", "æ–‡æ¡£å¤„ç†", "ä¼šè®®åŠ©æ‰‹", "é¡¹ç›®è§„åˆ’"]
    },
    
    "study_assistant": {
        "name": "å­¦ä¹ åŠ©æ‰‹", 
        "icon": "ğŸ“š",
        "system_prompt": """ä½ æ˜¯ä¸€ä¸ªè€å¿ƒçš„å­¦ä¹ åŠ©æ‰‹ï¼Œä¸“æ³¨äºï¼š
        - çŸ¥è¯†è§£ç­”å’Œæ¦‚å¿µè§£é‡Š
        - å­¦ä¹ æ–¹æ³•æŒ‡å¯¼
        - æŠ€èƒ½æå‡å»ºè®®
        - å­¦ä¹ è®¡åˆ’åˆ¶å®š
        
        è¯·ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼å¸®åŠ©ç”¨æˆ·å­¦ä¹ å’Œæˆé•¿ã€‚""",
        "theme_color": "#10B981",
        "features": ["çŸ¥è¯†é—®ç­”", "å­¦ä¹ è§„åˆ’", "æŠ€èƒ½æŒ‡å¯¼", "ä½œä¸šè¾…å¯¼"]
    },
    
    # ... å…¶ä»–åŠ©æ‰‹é…ç½®
}
```

### 2. è®°å¿†ç³»ç»Ÿè®¾è®¡

#### çŸ­æœŸè®°å¿†ï¼ˆä¼šè¯çº§åˆ«ï¼‰
- **å¯¹è¯å†å²**ï¼šä¿å­˜å½“å‰ä¼šè¯çš„æ‰€æœ‰æ¶ˆæ¯
- **ä¸Šä¸‹æ–‡ç†è§£**ï¼šç†è§£å¯¹è¯çš„è¿ç»­æ€§å’Œè¯­å¢ƒ
- **ä»»åŠ¡çŠ¶æ€**ï¼šè·Ÿè¸ªæ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡è¿›åº¦

#### é•¿æœŸè®°å¿†ï¼ˆç”¨æˆ·çº§åˆ«ï¼‰
- **ä¸ªäººåå¥½**ï¼šè®°ä½ç”¨æˆ·çš„ä½¿ç”¨ä¹ æƒ¯å’Œåå¥½
- **å†å²ä»»åŠ¡**ï¼šä¿å­˜å®Œæˆçš„ä»»åŠ¡å’Œé¡¹ç›®ä¿¡æ¯
- **å­¦ä¹ è¿›åº¦**ï¼šè·Ÿè¸ªç”¨æˆ·çš„å­¦ä¹ å†ç¨‹å’Œæˆæœ

```python
class MemoryService:
    def build_context(self, session_id, assistant_type):
        """æ„å»ºåŒ…å«è®°å¿†çš„å¯¹è¯ä¸Šä¸‹æ–‡"""
        # è·å–çŸ­æœŸè®°å¿†ï¼ˆå½“å‰ä¼šè¯ï¼‰
        recent_messages = self.get_recent_messages(session_id, limit=10)
        
        # è·å–é•¿æœŸè®°å¿†ï¼ˆç›¸å…³å†å²ï¼‰
        relevant_history = self.get_relevant_history(assistant_type, limit=5)
        
        # è·å–ä¸ªäººåå¥½
        user_preferences = self.get_user_preferences()
        
        return {
            "recent_context": recent_messages,
            "relevant_history": relevant_history,
            "user_preferences": user_preferences
        }
```

---

## ğŸ® AIæ¸¸æˆåŠŸèƒ½è®¾è®¡

### 1. ğŸ­ AIå‰§æœ¬æ€ä¸»æŒäºº

#### æ¸¸æˆæµç¨‹è®¾è®¡
```python
class ScriptHostGame:
    def __init__(self):
        self.game_state = {
            "phase": "preparation",  # preparation, role_assignment, gameplay, deduction, voting
            "players": [],
            "script": None,
            "clues": [],
            "timeline": [],
            "votes": {}
        }
    
    def start_game(self, script_type="modern_campus"):
        """å¼€å§‹æ¸¸æˆ"""
        # 1. ç”Ÿæˆå‰§æœ¬
        script = self.generate_script(script_type)
        
        # 2. åˆ†é…è§’è‰²
        roles = self.assign_roles(script)
        
        # 3. åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
        self.game_state.update({
            "phase": "role_assignment",
            "script": script,
            "players": roles
        })
        
        return self.get_game_intro()
    
    def generate_script(self, script_type):
        """AIç”Ÿæˆå‰§æœ¬"""
        prompt = f"""
        ç”Ÿæˆä¸€ä¸ª{script_type}é¢˜æçš„å‰§æœ¬æ€æ¡ˆä»¶ï¼ŒåŒ…å«ï¼š
        1. æ¡ˆä»¶èƒŒæ™¯å’Œæ—¶é—´çº¿
        2. å—å®³è€…ä¿¡æ¯å’Œæ­»å› 
        3. 5-6ä¸ªè§’è‰²çš„åŸºæœ¬ä¿¡æ¯å’ŒåŠ¨æœº
        4. å…³é”®çº¿ç´¢åˆ†å¸ƒ
        5. çœŸç›¸å’Œæ¨ç†è·¯å¾„
        
        è¦æ±‚å‰§æƒ…åˆç†ï¼Œé€»è¾‘æ¸…æ™°ï¼Œå…·æœ‰è¶³å¤Ÿçš„æ¨ç†æ€§ã€‚
        """
        
        return self.ai_service.generate_content(prompt)
```

#### ç•Œé¢ç»„ä»¶è®¾è®¡
```html
<!-- å‰§æœ¬æ€æ¸¸æˆç•Œé¢ -->
<div class="script-host-game">
    <!-- æ¸¸æˆå¤´éƒ¨ -->
    <header class="game-header script-theme">
        <div class="game-title">
            <h2>ğŸ­ AIå‰§æœ¬æ€ä¸»æŒäºº</h2>
            <span class="game-phase">{{ game_state.phase }}</span>
        </div>
        <div class="game-controls">
            <button class="btn-notes">ğŸ“ ç¬”è®°</button>
            <button class="btn-timeline">â° æ—¶é—´çº¿</button>
            <button class="btn-clues">ğŸ” çº¿ç´¢</button>
        </div>
    </header>
    
    <!-- è§’è‰²å±•ç¤ºåŒº -->
    <section class="roles-panel">
        <h3>è§’è‰²ä¿¡æ¯</h3>
        <div class="role-cards">
            {% for role in players %}
            <div class="role-card {{ 'dead' if role.is_dead }}">
                <div class="role-avatar">{{ role.icon }}</div>
                <div class="role-info">
                    <h4>{{ role.name }}</h4>
                    <p>{{ role.description }}</p>
                </div>
                <div class="role-status">
                    {% if role.is_dead %}
                    <span class="status-dead">ğŸ’€ å·²æ­»äº¡</span>
                    {% else %}
                    <span class="status-alive">â¤ï¸ å­˜æ´»</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    
    <!-- å‰§æƒ…å¯¹è¯åŒº -->
    <section class="story-dialogue">
        <div class="dialogue-container">
            {% for message in story_messages %}
            <div class="dialogue-bubble {{ message.speaker_type }}">
                <div class="speaker-info">
                    <span class="speaker-icon">{{ message.icon }}</span>
                    <span class="speaker-name">{{ message.speaker }}</span>
                </div>
                <div class="message-content">{{ message.content }}</div>
            </div>
            {% endfor %}
        </div>
    </section>
    
    <!-- ç”¨æˆ·æ“ä½œåŒº -->
    <section class="user-actions">
        <div class="action-buttons">
            <button class="action-btn investigate">ğŸ” è°ƒæŸ¥çº¿ç´¢</button>
            <button class="action-btn question">â“ è¯¢é—®è§’è‰²</button>
            <button class="action-btn accuse">ğŸ‘‰ æŒ‡æ§æŸäºº</button>
            <button class="action-btn vote">ğŸ—³ï¸ å‘èµ·æŠ•ç¥¨</button>
        </div>
        
        <div class="message-input">
            <textarea placeholder="è¾“å…¥ä½ çš„è¡ŒåŠ¨æˆ–å¯¹è¯..."></textarea>
            <button class="send-btn">å‘é€</button>
        </div>
    </section>
</div>
```

### 2. ğŸ” AIæ¨ç†ä¾¦æ¢æ¸¸æˆ

#### æ¸¸æˆæœºåˆ¶è®¾è®¡
```python
class DetectiveGame:
    def __init__(self):
        self.case_info = {}
        self.suspects = []
        self.evidence = []
        self.interrogation_history = {}
        self.deduction_points = 0
    
    def generate_case(self, case_type="murder"):
        """ç”Ÿæˆæ¡ˆä»¶"""
        prompt = f"""
        ç”Ÿæˆä¸€ä¸ª{case_type}æ¡ˆä»¶ï¼ŒåŒ…å«ï¼š
        1. æ¡ˆä»¶æ¦‚è¿°ï¼ˆæ—¶é—´ã€åœ°ç‚¹ã€å—å®³è€…ï¼‰
        2. ç°åœºæƒ…å†µå’Œåˆæ­¥è¯æ®
        3. 3-5ä¸ªå«Œç–‘äººï¼Œæ¯äººéƒ½æœ‰åŠ¨æœºå’Œä¸åœ¨åœºè¯æ˜
        4. éšè—çº¿ç´¢å’ŒçŸ›ç›¾ç‚¹
        5. çœŸç›¸è§£æå’Œæ¨ç†è·¯å¾„
        
        è¦æ±‚ï¼šé€»è¾‘ä¸¥å¯†ï¼Œæœ‰è¶³å¤Ÿçš„æ¨ç†éš¾åº¦ï¼Œå«Œç–‘äººä¸ªæ€§é²œæ˜ã€‚
        """
        
        case = self.ai_service.generate_content(prompt)
        self.case_info = self.parse_case_info(case)
        self.suspects = self.create_suspects(case)
        
        return self.case_info
    
    def interrogate_suspect(self, suspect_id, question):
        """å®¡é—®å«Œç–‘äºº"""
        suspect = self.get_suspect(suspect_id)
        
        # AIæ‰®æ¼”å«Œç–‘äººå›ç­”
        response = self.ai_service.roleplay_response(
            character=suspect,
            question=question,
            context=self.case_info,
            previous_interrogation=self.interrogation_history.get(suspect_id, [])
        )
        
        # è®°å½•å®¡é—®å†å²
        self.interrogation_history[suspect_id].append({
            "question": question,
            "answer": response,
            "timestamp": datetime.now()
        })
        
        # æ£€æŸ¥æ˜¯å¦å‘ç°çŸ›ç›¾
        contradictions = self.detect_contradictions(suspect_id, response)
        
        return {
            "response": response,
            "contradictions": contradictions,
            "new_clues": self.extract_clues(response)
        }
```

#### å®¡é—®ç•Œé¢è®¾è®¡
```html
<!-- æ¨ç†ä¾¦æ¢æ¸¸æˆç•Œé¢ -->
<div class="detective-game">
    <!-- æ¡ˆä»¶ä¿¡æ¯æ  -->
    <header class="case-header detective-theme">
        <div class="case-title">
            <h2>ğŸ” {{ case_info.title }}</h2>
            <p>{{ case_info.location }} Â· {{ case_info.time }}</p>
        </div>
        <div class="investigation-score">
            <span>æ¨ç†åˆ†æ•°: {{ deduction_points }}</span>
        </div>
    </header>
    
    <!-- å«Œç–‘äººé€‰æ‹©åŒº -->
    <section class="suspects-panel">
        <h3>å«Œç–‘äººåˆ—è¡¨</h3>
        <div class="suspect-tabs">
            {% for suspect in suspects %}
            <div class="suspect-tab {{ 'active' if suspect.id == current_suspect_id }}" 
                 onclick="selectSuspect('{{ suspect.id }}')">
                <div class="suspect-avatar">{{ suspect.icon }}</div>
                <div class="suspect-info">
                    <h4>{{ suspect.name }}</h4>
                    <p>{{ suspect.occupation }}</p>
                    <div class="suspicion-level">
                        <span class="level-{{ suspect.suspicion_level }}">
                            å«Œç–‘åº¦: {{ suspect.suspicion_level }}/5
                        </span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    
    <!-- å®¡é—®å¯¹è¯åŒº -->
    <section class="interrogation-area">
        <div class="current-suspect-info">
            <div class="suspect-portrait">
                <img src="{{ current_suspect.avatar }}" alt="{{ current_suspect.name }}">
                <h3>{{ current_suspect.name }}</h3>
                <p>{{ current_suspect.background }}</p>
            </div>
        </div>
        
        <div class="dialogue-history">
            {% for exchange in interrogation_history[current_suspect_id] %}
            <div class="dialogue-exchange">
                <div class="detective-question">
                    <span class="speaker">ğŸ•µï¸ ä¾¦æ¢:</span>
                    <span class="message">{{ exchange.question }}</span>
                </div>
                <div class="suspect-answer">
                    <span class="speaker">{{ current_suspect.icon }} {{ current_suspect.name }}:</span>
                    <span class="message">{{ exchange.answer }}</span>
                    {% if exchange.contradictions %}
                    <div class="contradictions">
                        âš ï¸ å‘ç°çŸ›ç›¾: {{ exchange.contradictions }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="question-input">
            <div class="quick-questions">
                <button class="quick-btn">ä½ å½“æ—¶åœ¨å“ªé‡Œï¼Ÿ</button>
                <button class="quick-btn">ä½ è®¤è¯†å—å®³è€…å—ï¼Ÿ</button>
                <button class="quick-btn">ä½ æœ‰ä¸åœ¨åœºè¯æ˜å—ï¼Ÿ</button>
            </div>
            <div class="custom-question">
                <textarea placeholder="è¾“å…¥ä½ çš„é—®é¢˜..."></textarea>
                <button class="ask-btn">è¯¢é—®</button>
            </div>
        </div>
    </section>
    
    <!-- è¯æ®é¢æ¿ -->
    <aside class="evidence-panel">
        <h3>ğŸ” è¯æ®æ¸…å•</h3>
        <div class="evidence-list">
            {% for evidence in evidence_list %}
            <div class="evidence-item">
                <div class="evidence-icon">{{ evidence.icon }}</div>
                <div class="evidence-info">
                    <h4>{{ evidence.name }}</h4>
                    <p>{{ evidence.description }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="deduction-area">
            <h3>ğŸ§  æ¨ç†ç»“è®º</h3>
            <textarea placeholder="è®°å½•ä½ çš„æ¨ç†è¿‡ç¨‹..."></textarea>
            <button class="submit-deduction">æäº¤æ¨ç†</button>
        </div>
    </aside>
</div>
```

### 3. ğŸº AIç‹¼äººæ€æ³•å®˜

#### æ¸¸æˆçŠ¶æ€ç®¡ç†
```python
class WerewolfGame:
    def __init__(self):
        self.game_state = {
            "phase": "preparation",  # preparation, night, day, voting, game_over
            "day_count": 0,
            "players": [],
            "alive_players": [],
            "dead_players": [],
            "votes": {},
            "night_actions": {}
        }
        
        self.roles = {
            "werewolf": {"name": "ç‹¼äºº", "team": "wolf", "ability": "kill"},
            "villager": {"name": "æ‘æ°‘", "team": "village", "ability": "none"},
            "seer": {"name": "é¢„è¨€å®¶", "team": "village", "ability": "investigate"},
            "doctor": {"name": "åŒ»ç”Ÿ", "team": "village", "ability": "heal"},
            "hunter": {"name": "çŒäºº", "team": "village", "ability": "revenge"}
        }
    
    def start_game(self, player_count=8):
        """å¼€å§‹æ¸¸æˆ"""
        # åˆ†é…è§’è‰²
        roles = self.assign_roles(player_count)
        
        # åˆ›å»ºAIç©å®¶
        players = self.create_ai_players(roles)
        
        self.game_state.update({
            "phase": "night",
            "day_count": 1,
            "players": players,
            "alive_players": [p for p in players if p["alive"]]
        })
        
        return self.get_game_start_message()
    
    def night_phase(self):
        """å¤œæ™šé˜¶æ®µ"""
        actions = {}
        
        # ç‹¼äººæ€äºº
        wolf_target = self.ai_wolf_action()
        actions["kill"] = wolf_target
        
        # é¢„è¨€å®¶æŸ¥éªŒ
        if self.has_alive_role("seer"):
            seer_target = self.ai_seer_action()
            actions["investigate"] = seer_target
        
        # åŒ»ç”Ÿæ•‘äºº
        if self.has_alive_role("doctor"):
            doctor_target = self.ai_doctor_action()
            actions["heal"] = doctor_target
        
        # è§£æå¤œæ™šç»“æœ
        result = self.resolve_night_actions(actions)
        
        self.game_state["phase"] = "day"
        return result
    
    def day_phase(self):
        """ç™½å¤©é˜¶æ®µ - AIç©å®¶å‘è¨€"""
        speeches = []
        
        for player in self.game_state["alive_players"]:
            speech = self.generate_ai_speech(player)
            speeches.append({
                "player": player,
                "content": speech
            })
        
        return speeches
    
    def generate_ai_speech(self, player):
        """ç”ŸæˆAIç©å®¶å‘è¨€"""
        prompt = f"""
        ä½ æ˜¯ç‹¼äººæ€æ¸¸æˆä¸­çš„{player['role']}ï¼Œåå­—æ˜¯{player['name']}ã€‚
        å½“å‰æ˜¯ç¬¬{self.game_state['day_count']}å¤©ï¼Œæ˜¨æ™š{self.get_night_summary()}ã€‚
        
        è¯·æ ¹æ®ä½ çš„èº«ä»½å’Œå½“å‰å±€åŠ¿å‘è¨€ï¼š
        1. å¦‚æœä½ æ˜¯ç‹¼äººï¼Œè¦éšè—èº«ä»½ï¼Œè¯¯å¯¼æ‘æ°‘
        2. å¦‚æœä½ æ˜¯æ‘æ°‘ï¼Œè¦å¯»æ‰¾ç‹¼äººçš„ç ´ç»½
        3. å¦‚æœä½ æ˜¯ç¥èŒï¼Œè¦åˆç†ä½¿ç”¨ä¿¡æ¯
        
        å‘è¨€è¦ç¬¦åˆè§’è‰²æ€§æ ¼ï¼š{player['personality']}
        """
        
        return self.ai_service.generate_speech(prompt, player)
```

#### ç‹¼äººæ€ç•Œé¢è®¾è®¡
```html
<!-- ç‹¼äººæ€æ¸¸æˆç•Œé¢ -->
<div class="werewolf-game">
    <!-- æ¸¸æˆçŠ¶æ€æ  -->
    <header class="game-status werewolf-theme">
        <div class="phase-indicator">
            <span class="phase-icon">{{ phase_icon }}</span>
            <span class="phase-text">{{ current_phase }}</span>
            <span class="day-counter">ç¬¬ {{ day_count }} å¤©</span>
        </div>
        <div class="team-status">
            <span class="wolf-count">ğŸº {{ wolf_count }}</span>
            <span class="village-count">ğŸ‘¥ {{ village_count }}</span>
        </div>
    </header>
    
    <!-- ç©å®¶çŠ¶æ€åŒºåŸŸ -->
    <section class="players-area">
        <div class="players-grid">
            {% for player in all_players %}
            <div class="player-card {{ 'dead' if not player.alive }} {{ 'highlight' if player.is_speaking }}">
                <div class="player-avatar">
                    <img src="{{ player.avatar }}" alt="{{ player.name }}">
                    {% if not player.alive %}
                    <div class="death-overlay">ğŸ’€</div>
                    {% endif %}
                </div>
                <div class="player-info">
                    <h4>{{ player.name }}</h4>
                    <p class="player-number">{{ player.position }}å·</p>
                    {% if not player.alive %}
                    <p class="death-role">{{ player.revealed_role }}</p>
                    {% endif %}
                </div>
                <div class="player-actions">
                    {% if current_phase == 'voting' and player.alive %}
                    <button class="vote-btn" onclick="votePlayer('{{ player.id }}')">
                        æŠ•ç¥¨
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    
    <!-- æ¸¸æˆæ—¥å¿—åŒºåŸŸ -->
    <section class="game-log">
        <div class="log-tabs">
            <button class="tab-btn active" data-tab="speeches">ğŸ’¬ å‘è¨€</button>
            <button class="tab-btn" data-tab="actions">ğŸŒ™ å¤œæ™š</button>
            <button class="tab-btn" data-tab="votes">ğŸ—³ï¸ æŠ•ç¥¨</button>
        </div>
        
        <div class="log-content">
            <div class="log-tab speeches active">
                {% for speech in day_speeches %}
                <div class="speech-item">
                    <div class="speaker-info">
                        <span class="speaker-avatar">{{ speech.player.avatar }}</span>
                        <span class="speaker-name">{{ speech.player.name }}</span>
                        <span class="speech-time">{{ speech.timestamp }}</span>
                    </div>
                    <div class="speech-content">{{ speech.content }}</div>
                </div>
                {% endfor %}
            </div>
            
            <div class="log-tab actions">
                {% for action in night_actions %}
                <div class="action-item">
                    <span class="action-icon">{{ action.icon }}</span>
                    <span class="action-text">{{ action.description }}</span>
                </div>
                {% endfor %}
            </div>
            
            <div class="log-tab votes">
                {% for vote_result in vote_history %}
                <div class="vote-item">
                    <div class="vote-summary">{{ vote_result.summary }}</div>
                    <div class="vote-details">{{ vote_result.details }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    
    <!-- ç”¨æˆ·æ“ä½œåŒº -->
    <section class="user-controls">
        {% if current_phase == 'day' %}
        <div class="speech-input">
            <textarea placeholder="è¾“å…¥ä½ çš„å‘è¨€å†…å®¹..."></textarea>
            <button class="speak-btn">ğŸ—£ï¸ å‘è¨€</button>
        </div>
        {% elif current_phase == 'voting' %}
        <div class="voting-controls">
            <h3>æŠ•ç¥¨é˜¶æ®µ</h3>
            <p>è¯·é€‰æ‹©ä½ è¦æŠ•ç¥¨çš„ç©å®¶</p>
            <div class="vote-buttons">
                {% for player in alive_players %}
                <button class="vote-option" onclick="submitVote('{{ player.id }}')">
                    æŠ•ç¥¨ç»™ {{ player.name }}
                </button>
                {% endfor %}
            </div>
        </div>
        {% elif current_phase == 'night' %}
        <div class="night-info">
            <h3>ğŸŒ™ å¤œæ™šé™ä¸´</h3>
            <p>å¤©é»‘è¯·é—­çœ¼ï¼Œç­‰å¾…å¤©äº®...</p>
            <div class="night-timer">
                <span id="night-countdown">30</span> ç§’åå¤©äº®
            </div>
        </div>
        {% endif %}
    </section>
</div>
```

---

## ğŸ”Œ APIé›†æˆæ–¹æ¡ˆ

### OpenRouteræœåŠ¡å°è£…
```python
class OpenRouterService:
    def __init__(self, api_key):
        self.api_key = api_key
        self.base_url = "https://openrouter.ai/api/v1"
        self.available_models = {
            "gemini-pro": "google/gemini-2.5-pro",
            "gemini-flash": "google/gemini-2.5-flash",
            "claude-opus": "anthropic/claude-opus-4",
            "gpt-4": "openai/gpt-4.1"
        }
    
    def chat_completion(self, model, messages, stream=False):
        """èŠå¤©å®Œæˆ"""
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }
        
        data = {
            "model": self.available_models.get(model, model),
            "messages": messages,
            "stream": stream,
            "temperature": 0.7,
            "max_tokens": 2000
        }
        
        response = requests.post(
            f"{self.base_url}/chat/completions",
            headers=headers,
            json=data,
            stream=stream
        )
        
        if stream:
            return self._handle_stream_response(response)
        else:
            return response.json()
    
    def generate_content(self, prompt, model="gemini-pro"):
        """ç”Ÿæˆå†…å®¹ï¼ˆé€‚ç”¨äºæ¸¸æˆå‰§æœ¬ç”Ÿæˆï¼‰"""
        messages = [{"role": "user", "content": prompt}]
        return self.chat_completion(model, messages)
```

### æ¨¡å‹é€‰æ‹©ç­–ç•¥
```python
MODEL_USAGE_MAP = {
    "chat": {
        "default": "gemini-flash",      # å¿«é€Ÿå“åº”
        "complex": "gemini-pro",        # å¤æ‚ä»»åŠ¡
        "creative": "claude-opus"       # åˆ›æ„ä»»åŠ¡
    },
    "game": {
        "script_generation": "claude-opus",    # å‰§æœ¬åˆ›ä½œ
        "character_roleplay": "gemini-pro",    # è§’è‰²æ‰®æ¼”
        "logic_reasoning": "gpt-4"             # é€»è¾‘æ¨ç†
    }
}
```

---

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### æ•°æ®è¡¨ç»“æ„
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100),
    password_hash VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP
);

-- ä¼šè¯è¡¨
CREATE TABLE conversations (
    id VARCHAR(36) PRIMARY KEY,  -- UUID
    user_id INTEGER,
    assistant_type VARCHAR(50),
    title VARCHAR(200),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- æ¶ˆæ¯è¡¨
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    conversation_id VARCHAR(36),
    role VARCHAR(20),  -- user, assistant, system
    content TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    metadata JSON,  -- é¢å¤–ä¿¡æ¯ï¼ˆæ¨¡å‹ã€tokensç­‰ï¼‰
    FOREIGN KEY (conversation_id) REFERENCES conversations(id)
);

-- æ¸¸æˆå­˜æ¡£è¡¨
CREATE TABLE game_saves (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    game_type VARCHAR(50),
    save_name VARCHAR(100),
    game_state JSON,  -- æ¸¸æˆçŠ¶æ€æ•°æ®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- ç”¨æˆ·åå¥½è¡¨
CREATE TABLE user_preferences (
    user_id INTEGER PRIMARY KEY,
    preferred_model VARCHAR(50),
    theme VARCHAR(20),
    language VARCHAR(10),
    settings JSON,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

## ğŸ”„ ç”¨æˆ·äº¤äº’æµç¨‹

### AIåŠ©æ‰‹äº¤äº’æµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·è®¿é—®ä¸»é¡µ] --> B[é€‰æ‹©AIåŠ©æ‰‹]
    B --> C[æ‰“å¼€å¯¹è¯ç•Œé¢]
    C --> D[ç”¨æˆ·è¾“å…¥æ¶ˆæ¯]
    D --> E[ç³»ç»Ÿå¤„ç†æ¶ˆæ¯]
    E --> F[è°ƒç”¨OpenRouter API]
    F --> G[AIç”Ÿæˆå›å¤]
    G --> H[æ˜¾ç¤ºå›å¤ç»™ç”¨æˆ·]
    H --> I{ç”¨æˆ·ç»§ç»­å¯¹è¯?}
    I -->|æ˜¯| D
    I -->|å¦| J[ä¿å­˜ä¼šè¯å†å²]
    J --> K[è¿”å›ä¸»é¡µ]
```

### æ¸¸æˆäº¤äº’æµç¨‹ï¼ˆä»¥å‰§æœ¬æ€ä¸ºä¾‹ï¼‰
```mermaid
graph TD
    A[é€‰æ‹©å‰§æœ¬æ€æ¸¸æˆ] --> B[é€‰æ‹©å‰§æœ¬ç±»å‹]
    B --> C[AIç”Ÿæˆå‰§æœ¬]
    C --> D[åˆ†é…è§’è‰²]
    D --> E[æ¸¸æˆå¼€å§‹]
    E --> F[ç”¨æˆ·è¡ŒåŠ¨/å¯¹è¯]
    F --> G[AIå“åº”å‰§æƒ…]
    G --> H[æ›´æ–°æ¸¸æˆçŠ¶æ€]
    H --> I{æ¸¸æˆç»“æŸ?}
    I -->|å¦| F
    I -->|æ˜¯| J[æ˜¾ç¤ºç»“å±€]
    J --> K[ä¿å­˜æ¸¸æˆè®°å½•]
    K --> L[è¿”å›æ¸¸æˆé€‰æ‹©]
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. APIè°ƒç”¨ä¼˜åŒ–
- **ç¼“å­˜æœºåˆ¶**ï¼šç¼“å­˜å¸¸ç”¨çš„AIå›å¤å’Œæ¸¸æˆæ¨¡æ¿
- **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨å¼‚æ­¥è¯·æ±‚é¿å…ç•Œé¢é˜»å¡
- **æµå¼å“åº”**ï¼šæ”¯æŒå®æ—¶æ˜¾ç¤ºAIç”Ÿæˆå†…å®¹
- **è¯·æ±‚é˜Ÿåˆ—**ï¼šç®¡ç†å¹¶å‘è¯·æ±‚ï¼Œé¿å…APIé™åˆ¶

### 2. å‰ç«¯æ€§èƒ½ä¼˜åŒ–
- **ç»„ä»¶å¤ç”¨**ï¼šé€šç”¨ç»„ä»¶æ¨¡å—åŒ–è®¾è®¡
- **æ‡’åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½æ¸¸æˆç•Œé¢å’Œèµ„æº
- **æœ¬åœ°å­˜å‚¨**ï¼šç¼“å­˜ç”¨æˆ·åå¥½å’Œä¸´æ—¶æ•°æ®
- **å“åº”å¼å›¾ç‰‡**ï¼šæ ¹æ®è®¾å¤‡ä¼˜åŒ–å›¾ç‰‡åŠ è½½

### 3. æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢æ·»åŠ ç´¢å¼•
- **æ•°æ®åˆ†é¡µ**ï¼šå¤§é‡å†å²è®°å½•åˆ†é¡µåŠ è½½
- **å®šæœŸæ¸…ç†**ï¼šæ¸…ç†è¿‡æœŸçš„ä¸´æ—¶æ•°æ®
- **å¤‡ä»½ç­–ç•¥**ï¼šå®šæœŸå¤‡ä»½é‡è¦æ•°æ®

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. APIå®‰å…¨
- **å¯†é’¥ç®¡ç†**ï¼šå®‰å…¨å­˜å‚¨å’Œç®¡ç†APIå¯†é’¥
- **è¯·æ±‚é™åˆ¶**ï¼šé˜²æ­¢APIæ»¥ç”¨å’Œæˆæœ¬è¶…æ”¯
- **é”™è¯¯å¤„ç†**ï¼šå¦¥å–„å¤„ç†APIé”™è¯¯å’Œå¼‚å¸¸

### 2. ç”¨æˆ·æ•°æ®å®‰å…¨
- **å¯†ç åŠ å¯†**ï¼šä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•ä¿æŠ¤å¯†ç 
- **ä¼šè¯ç®¡ç†**ï¼šå®‰å…¨çš„ç”¨æˆ·ä¼šè¯æœºåˆ¶
- **æ•°æ®éšç§**ï¼šç”¨æˆ·æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ ç¬¬ä¸‰æ–¹

### 3. å†…å®¹å®‰å…¨
- **è¾“å…¥éªŒè¯**ï¼šé˜²æ­¢æ¶æ„è¾“å…¥å’Œæ³¨å…¥æ”»å‡»
- **å†…å®¹è¿‡æ»¤**ï¼šè¿‡æ»¤ä¸å½“å†…å®¹å’Œæ•æ„Ÿä¿¡æ¯
- **è®¿é—®æ§åˆ¶**ï¼šé€‚å½“çš„æƒé™ç®¡ç†æœºåˆ¶

---

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### æœ¬åœ°éƒ¨ç½²
```bash
# ç¯å¢ƒå‡†å¤‡
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# æ•°æ®åº“åˆå§‹åŒ–
python init_db.py

# å¯åŠ¨åº”ç”¨
python app.py
```

### Dockeréƒ¨ç½²
```dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
EXPOSE 5000

CMD ["python", "app.py"]
```

è¿™ä¸ªåŠŸèƒ½è®¾è®¡æ–‡æ¡£æä¾›äº†å®Œæ•´çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆï¼Œæ¥ä¸‹æ¥æˆ‘å°†åˆ›å»ºç•Œé¢è®¾è®¡æ–‡æ¡£æ¥è¯¦ç»†è¯´æ˜UI/UXè®¾è®¡ã€‚